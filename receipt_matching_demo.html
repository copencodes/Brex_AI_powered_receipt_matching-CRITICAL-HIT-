<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Receipt Matching System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .demo-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .input-panel {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }

        .input-panel h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #3498db;
        }

        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }

        .results-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }

        .results-panel h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .match-result {
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 4px solid;
            animation: slideIn 0.5s ease-out;
        }

        .auto-match {
            background: #d4edda;
            border-left-color: #28a745;
        }

        .review {
            background: #fff3cd;
            border-left-color: #ffc107;
        }

        .reject {
            background: #f8d7da;
            border-left-color: #dc3545;
        }

        .confidence-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .confidence-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.8s ease-out;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .feature-score {
            background: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #dee2e6;
        }

        .feature-score .label {
            font-size: 12px;
            color: #6c757d;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .feature-score .value {
            font-size: 18px;
            font-weight: 700;
            color: #2c3e50;
        }

        .sample-data {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .data-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }

        .data-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .data-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 8px;
            font-size: 14px;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .config-panel {
            background: #e8f4f8;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🧾 AI Receipt Matching System</h1>
            <p>Advanced machine learning-powered receipt-to-transaction matching with confidence scoring</p>
        </div>

        <div class="main-content">
            <!-- Sample Data Display -->
            <div class="sample-data">
                <div class="data-card">
                    <h4>📄 Sample Receipts</h4>
                    <div id="receipts-list"></div>
                </div>
                <div class="data-card">
                    <h4>💳 Sample Transactions</h4>
                    <div id="transactions-list"></div>
                </div>
            </div>

            <!-- Demo Controls -->
            <div class="demo-section">
                <div class="input-panel">
                    <h3>🎯 Custom Receipt</h3>
                    <div class="form-group">
                        <label>Vendor:</label>
                        <input type="text" id="receipt-vendor" placeholder="e.g., Starbucks">
                    </div>
                    <div class="form-group">
                        <label>Amount:</label>
                        <input type="number" id="receipt-amount" step="0.01" placeholder="e.g., 4.50">
                    </div>
                    <div class="form-group">
                        <label>Date:</label>
                        <input type="date" id="receipt-date">
                    </div>
                    <div class="form-group">
                        <label>Currency:</label>
                        <select id="receipt-currency">
                            <option value="USD">USD</option>
                            <option value="GBP">GBP</option>
                            <option value="EUR">EUR</option>
                            <option value="INR">INR</option>
                            <option value="JPY">JPY</option>
                            <option value="CNY">CNY</option>
                            <option value="RUB">RUB</option>

                        </select>
                    </div>
                </div>

                <div class="input-panel">
                    <h3>💰 Custom Transaction</h3>
                    <div class="form-group">
                        <label>Merchant:</label>
                        <input type="text" id="txn-merchant" placeholder="e.g., Starbucks Coffee">
                    </div>
                    <div class="form-group">
                        <label>Amount:</label>
                        <input type="number" id="txn-amount" step="0.01" placeholder="e.g., 4.50">
                    </div>
                    <div class="form-group">
                        <label>Date:</label>
                        <input type="date" id="txn-date">
                    </div>
                    <div class="form-group">
                        <label>Currency:</label>
                        <select id="txn-currency">
                            <option value="USD">USD</option>
                            <option value="GBP">GBP</option>
                            <option value="EUR">EUR</option>
                            <option value="INR">INR</option>
                            <option value="JPY">JPY</option>
                            <option value="CNY">CNY</option>
                            <option value="RUB">RUB</option>

                        </select>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div style="text-align: center; margin: 20px 0;">
                <button class="btn" onclick="runDemo()">🚀 Run Full Demo</button>
                <button class="btn" onclick="matchCustomPair()">🎯 Match Custom Pair</button>
                <button class="btn btn-secondary" onclick="loadRandomSample()">🎲 Load Random Sample</button>
            </div>

            <!-- Configuration Panel -->
            <div class="config-panel">
                <h3>⚙️ Configuration</h3>
                <div class="config-grid">
                    <div class="form-group">
                        <label>Auto-Match Threshold:</label>
                        <input type="number" id="auto-threshold" step="0.01" min="0" max="1" value="0.90">
                    </div>
                    <div class="form-group">
                        <label>Review Threshold:</label>
                        <input type="number" id="review-threshold" step="0.01" min="0" max="1" value="0.70">
                    </div>
                    <div class="form-group">
                        <label>Max Date Difference (days):</label>
                        <input type="number" id="max-date-diff" min="1" max="30" value="14">
                    </div>
                    <div class="form-group">
                        <label>Max Amount Deviation (%):</label>
                        <input type="number" id="max-amount-dev" step="0.01" min="0" max="0.5" value="0.10">
                    </div>
                </div>
            </div>

            <!-- Results Panel -->
            <div class="results-panel" id="results-panel" style="display: none;">
                <h3>🎯 Matching Results</h3>
                <div id="results-content"></div>
            </div>
        </div>
    </div>

    <script>
        // Sample data
        sampleReceipts = [
            {id: "R1", vendor: "Starbucks", amount: 4.50, date: "2025-08-12", currency: "USD"},
            {id: "R2", vendor: "Uber", amount: 23.75, date: "2025-08-11", currency: "USD"},
            {id: "R3", vendor: "Delta Air Lines", amount: 412.30, date: "2025-08-08", currency: "USD"},
            {id: "R4", vendor: "Caffè Nero", amount: 6.00, date: "2025-08-01", currency: "GBP"},
            {id: "R1", vendor: "DoorDash", amount: 45.00, date: "2025-08-12", currency: "USD"},
            {id: "R2", vendor: "Scale AI", amount: 3500.00, date: "2025-08-11", currency: "INR"},
            {id: "R3", vendor: "SeatGeek", amount: 120.00, date: "2025-08-08", currency: "EUR"},
            {id: "R4", vendor: "Lemonade", amount: 150.00, date: "2025-08-01", currency: "GBP"},
            {id: "R5", vendor: "Coinbase", amount: 60000.00, date: "2025-08-05", currency: "JPY"},
            {id: "R6", vendor: "Allbirds", amount: 799.00, date: "2025-08-07", currency: "CNY"}
        ];

        const sampleTransactions = [
            {id: "T101", merchant: "Starbucks Coffee", amount: 4.50, date: "2025-08-12", currency: "USD"},
            {id: "T102", merchant: "Uber Technologies", amount: 23.70, date: "2025-08-11", currency: "USD"},
            {id: "T103", merchant: "Delta Airlines", amount: 412.30, date: "2025-08-09", currency: "USD"},
            {id: "T104", merchant: "Caffe Nero", amount: 6.05, date: "2025-08-02", currency: "GBP"},
            {id: "T105", merchant: "Amazon", amount: 99.99, date: "2025-08-10", currency: "USD"},
            {id: "T101", merchant: "DoorDash", amount: 45.00, date: "2025-08-12", currency: "USD"},   // matches R1
            {id: "T102", merchant: "Scale AI", amount: 3500.00, date: "2025-08-11", currency: "INR"}, // matches R2
            {id: "T103", merchant: "SeatGeek", amount: 120.00, date: "2025-08-08", currency: "EUR"},  // matches R3
            {id: "T104", merchant: "Lemonade", amount: 150.00, date: "2025-08-01", currency: "GBP"},  // matches R4
            {id: "T105", merchant: "Coinbase", amount: 60000.00, date: "2025-08-05", currency: "JPY"},// matches R5
            {id: "T106", merchant: "Allbirds", amount: 799.00, date: "2025-08-07", currency: "CNY"},  // matches R6
            {id: "T107", merchant: "MasterClass", amount: 199.00, date: "2025-08-03", currency: "RUB"},
            {id: "T108", merchant: "Superhuman", amount: 9.99, date: "2025-08-10", currency: "USD"}
        ];

        // Initialize page
        function init() {
            displaySampleData();
            setTodayDates();
        }

        function displaySampleData() {
            const receiptsList = document.getElementById('receipts-list');
            const transactionsList = document.getElementById('transactions-list');

            receiptsList.innerHTML = sampleReceipts.map(r => 
                `<div class="data-item"><strong>${r.id}</strong>: ${r.vendor} - ${r.currency} ${r.amount} (${r.date})</div>`
            ).join('');

            transactionsList.innerHTML = sampleTransactions.map(t => 
                `<div class="data-item"><strong>${t.id}</strong>: ${t.merchant} - ${t.currency} ${t.amount} (${t.date})</div>`
            ).join('');
        }

        function setTodayDates() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('receipt-date').value = today;
            document.getElementById('txn-date').value = today;
        }

        // Fuzzy string matching
        function fuzzTokenSetRatio(a, b) {
            if (!a || !b) return 0;
            const normalize = str => str.toLowerCase().replace(/[^a-z0-9\s]/g, '').trim();
            const tokensA = new Set(normalize(a).split(/\s+/));
            const tokensB = new Set(normalize(b).split(/\s+/));
            
            const intersection = new Set([...tokensA].filter(x => tokensB.has(x)));
            const union = new Set([...tokensA, ...tokensB]);
            
            return union.size > 0 ? intersection.size / union.size : 0;
        }

        // Feature extraction
        function extractFeatures(receipt, transaction, config) {
            const vendorScore = fuzzTokenSetRatio(receipt.vendor, transaction.merchant);
            
            const amountDev = Math.abs(receipt.amount - transaction.amount) / Math.max(receipt.amount, transaction.amount);
            const amountScore = amountDev <= config.maxAmountDev ? 1.0 : 
                Math.max(0, 1.0 - (amountDev - config.maxAmountDev) / config.maxAmountDev);
            
            const dateDiff = Math.abs((new Date(receipt.date) - new Date(transaction.date)) / (1000 * 60 * 60 * 24));
            const dateScore = dateDiff <= 0 ? 1.0 : Math.exp(-dateDiff / (config.maxDateDiff / 2));
            
            const contextScore = receipt.currency === transaction.currency ? 1.0 : 0.0;
            
            return {
                vendorScore,
                amountScore,
                dateScore,
                contextScore,
                amountDeviation: amountDev,
                dateDiffDays: dateDiff
            };
        }

        // Confidence scoring
        function calculateConfidence(features) {
            const weights = {vendor: 0.45, amount: 0.35, date: 0.15, context: 0.05};
            const z = (weights.vendor * features.vendorScore +
                      weights.amount * features.amountScore +
                      weights.date * features.dateScore +
                      weights.context * features.contextScore - 0.5) * 4.0;
            return 1.0 / (1.0 + Math.exp(-z));
        }

        // Decision logic
        function makeDecision(confidence, features, config) {
            const reasons = [];
            
            if (features.dateDiffDays > config.maxDateDiff) {
                reasons.push(`date_diff_days>${config.maxDateDiff}`);
            }
            if (features.amountDeviation > config.maxAmountDev * 2) {
                reasons.push(`amount_dev>${(config.maxAmountDev * 2 * 100).toFixed(0)}%`);
            }
            
            let decision;
            if (reasons.length > 0) {
                decision = confidence >= config.reviewThreshold ? "Review" : "Reject";
                reasons.push("guardrail_triggered");
            } else {
                if (confidence >= config.autoThreshold) {
                    decision = "Auto-Match";
                } else if (confidence >= config.reviewThreshold) {
                    decision = "Review";
                } else {
                    decision = "Reject";
                }
            }
            
            return {decision, confidence, reasons};
        }

        function getConfig() {
            return {
                autoThreshold: parseFloat(document.getElementById('auto-threshold').value),
                reviewThreshold: parseFloat(document.getElementById('review-threshold').value),
                maxDateDiff: parseInt(document.getElementById('max-date-diff').value),
                maxAmountDev: parseFloat(document.getElementById('max-amount-dev').value)
            };
        }

        function displayResult(receipt, transaction, result, features) {
            const decisionClass = result.decision.toLowerCase().replace('-', '');
            const confidenceColor = result.confidence >= 0.9 ? '#28a745' : 
                                   result.confidence >= 0.7 ? '#ffc107' : '#dc3545';
            
            return `
                <div class="match-result ${decisionClass}">
                    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 15px;">
                        <div>
                            <h4>${receipt.vendor || receipt.id} → ${transaction.merchant || transaction.id}</h4>
                            <p>Decision: <strong>${result.decision}</strong></p>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 24px; font-weight: 700; color: ${confidenceColor};">
                                ${(result.confidence * 100).toFixed(1)}%
                            </div>
                            <div style="font-size: 12px; color: #6c757d;">CONFIDENCE</div>
                        </div>
                    </div>
                    
                    <div class="confidence-bar">
                        <div class="confidence-fill" style="width: ${result.confidence * 100}%; background: ${confidenceColor};"></div>
                    </div>
                    
                    <div class="features-grid">
                        <div class="feature-score">
                            <div class="label">Vendor Match</div>
                            <div class="value">${(features.vendorScore * 100).toFixed(0)}%</div>
                        </div>
                        <div class="feature-score">
                            <div class="label">Amount Match</div>
                            <div class="value">${(features.amountScore * 100).toFixed(0)}%</div>
                        </div>
                        <div class="feature-score">
                            <div class="label">Date Proximity</div>
                            <div class="value">${(features.dateScore * 100).toFixed(0)}%</div>
                        </div>
                        <div class="feature-score">
                            <div class="label">Context Match</div>
                            <div class="value">${(features.contextScore * 100).toFixed(0)}%</div>
                        </div>
                    </div>
                    
                    ${result.reasons.length > 0 ? `
                        <div style="margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.05); border-radius: 6px;">
                            <strong>Reasons:</strong> ${result.reasons.join(', ')}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function runDemo() {
            const config = getConfig();
            const results = [];
            
            // Find best match for each receipt
            sampleReceipts.forEach(receipt => {
                let bestMatch = null;
                let bestScore = -1;
                
                sampleTransactions.forEach(transaction => {
                    const features = extractFeatures(receipt, transaction, config);
                    const confidence = calculateConfidence(features);
                    const decision = makeDecision(confidence, features, config);
                    
                    if (confidence > bestScore) {
                        bestScore = confidence;
                        bestMatch = {receipt, transaction, result: decision, features};
                    }
                });
                
                if (bestMatch) {
                    results.push(bestMatch);
                }
            });
            
            displayResults(results);
        }

        function matchCustomPair() {
            const receipt = {
                vendor: document.getElementById('receipt-vendor').value || "Unknown Vendor",
                amount: parseFloat(document.getElementById('receipt-amount').value) || 0,
                date: document.getElementById('receipt-date').value || new Date().toISOString().split('T')[0],
                currency: document.getElementById('receipt-currency').value
            };
            
            const transaction = {
                merchant: document.getElementById('txn-merchant').value || "Unknown Merchant",
                amount: parseFloat(document.getElementById('txn-amount').value) || 0,
                date: document.getElementById('txn-date').value || new Date().toISOString().split('T')[0],
                currency: document.getElementById('txn-currency').value
            };
            
            const config = getConfig();
            const features = extractFeatures(receipt, transaction, config);
            const confidence = calculateConfidence(features);
            const result = makeDecision(confidence, features, config);
            
            displayResults([{receipt, transaction, result, features}]);
        }

        function loadRandomSample() {
            const randomReceipt = sampleReceipts[Math.floor(Math.random() * sampleReceipts.length)];
            const randomTransaction = sampleTransactions[Math.floor(Math.random() * sampleTransactions.length)];
            
            document.getElementById('receipt-vendor').value = randomReceipt.vendor;
            document.getElementById('receipt-amount').value = randomReceipt.amount;
            document.getElementById('receipt-date').value = randomReceipt.date;
            document.getElementById('receipt-currency').value = randomReceipt.currency;
            
            document.getElementById('txn-merchant').value = randomTransaction.merchant;
            document.getElementById('txn-amount').value = randomTransaction.amount;
            document.getElementById('txn-date').value = randomTransaction.date;
            document.getElementById('txn-currency').value = randomTransaction.currency;
        }

        function displayResults(results) {
            const panel = document.getElementById('results-panel');
            const content = document.getElementById('results-content');
            
            content.innerHTML = results.map(r => 
                displayResult(r.receipt, r.transaction, r.result, r.features)
            ).join('');
            
            panel.style.display = 'block';
            panel.scrollIntoView({behavior: 'smooth'});
        }

        // Initialize on load
        init();
    </script>
</body>
</html>